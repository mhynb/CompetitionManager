<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>多表分页示例</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
<div class="container mt-5">
  <h1 class="text-center mb-4">多表分页示例</h1>

  <!-- 操作按钮 -->
  <div class="mb-3 d-flex justify-content-between">
    <button id="addButton" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addModal">+ 新增分类</button>
  </div>

  <!-- 表格展示 -->
  <table id="dataTable" class="table table-bordered table-hover text-center">
    <thead>
    <tr>
      <th>分类名称</th>
      <th>分类类型</th>
      <th>操作时间</th>
      <th>排序</th>
      <th>操作</th>
    </tr>
    </thead>
    <tbody id="tableBody">
    <!-- 动态表内容 -->
    </tbody>
  </table>

  <!-- 分页控制 -->
  <div class="d-flex justify-content-between align-items-center">
    <button id="prevPage" class="btn btn-primary">上一页</button>
    <span id="currentPage">当前页：1</span>
    <button id="nextPage" class="btn btn-primary">下一页</button>
  </div>
</div>

<!-- 删除确认模态框 -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">提示</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        此操作将永久删除该文件，是否继续？
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        <button type="button" class="btn btn-warning" id="confirmDelete">确定</button>
      </div>
    </div>
  </div>
</div>

<!-- 新增模态框 -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addModalLabel">新增分类</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="addForm">
          <div class="mb-3">
            <label for="addName" class="form-label">分类名称：</label>
            <input type="text" class="form-control" id="addName" placeholder="请输入分类名称" required>
          </div>
          <div class="mb-3">
            <label for="addOrder" class="form-label">排序：</label>
            <input type="number" class="form-control" id="addOrder" placeholder="请输入排序" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        <button type="submit" class="btn btn-primary" id="saveAdd">确定</button>
      </div>
    </div>
  </div>
</div>

<!-- 修改模态框 -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">修改分类</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editForm">
          <div class="mb-3">
            <label for="editName" class="form-label">分类名称：</label>
            <input type="text" class="form-control" id="editName" required>
          </div>
          <div class="mb-3">
            <label for="editOrder" class="form-label">排序：</label>
            <input type="number" class="form-control" id="editOrder" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        <button type="submit" class="btn btn-primary" id="saveEdit">确定</button>
      </div>
    </div>
  </div>
</div>

<script>
  let currentPage = 1;
  const pageSize = 5;
  const baseUrl = "http://localhost:8080/admin";
  const tableBody = document.getElementById("tableBody");
  const currentPageSpan = document.getElementById("currentPage");
  const prevPageBtn = document.getElementById("prevPage");
  const nextPageBtn = document.getElementById("nextPage");
  const confirmDeleteBtn = document.getElementById("confirmDelete");
  let deleteId = null;
  let editId = null;

  // 加载表格数据
  async function loadTableData() {
    try {
      const response = await axios.get(`${baseUrl}/getCategories`, {
        params: { page: currentPage, pageSize },
      });
      const data = response.data.data.records;
      const total = response.data.data.total;

      tableBody.innerHTML = "";
      data.forEach((row) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.name}</td>
          <td>${row.type}</td>
          <td>${row.time}</td>
          <td>${row.order}</td>
          <td>
            <button class="btn btn-link text-primary" onclick="showEditModal(${row.id}, '${row.name}', ${row.order})">修改</button>
            <button class="btn btn-link text-danger" onclick="showDeleteModal(${row.id})">删除</button>
          </td>
        `;
        tableBody.appendChild(tr);
      });

      currentPageSpan.textContent = `当前页：${currentPage}`;
      prevPageBtn.disabled = currentPage === 1;
      nextPageBtn.disabled = currentPage * pageSize >= total;
    } catch (error) {
      console.error("加载数据失败：", error);
    }
  }

  // 显示删除模态框
  function showDeleteModal(id) {
    deleteId = id;
    const deleteModal = new bootstrap.Modal(document.getElementById("deleteModal"));
    deleteModal.show();
  }

  // 确认删除
  confirmDeleteBtn.addEventListener("click", async () => {
    try {
      await axios.delete(`${baseUrl}/deleteCategory`, { params: { id: deleteId } });
      const deleteModal = bootstrap.Modal.getInstance(document.getElementById("deleteModal"));
      deleteModal.hide();
      loadTableData();
    } catch (error) {
      console.error("删除失败：", error);
    }
  });

  // 显示编辑模态框
  function showEditModal(id, name, order) {
    editId = id;
    document.getElementById("editName").value = name;
    document.getElementById("editOrder").value = order;
    const editModal = new bootstrap.Modal(document.getElementById("editModal"));
    editModal.show();
  }

  // 保存编辑
  document.getElementById("saveEdit").addEventListener("click", async () => {
    try {
      const name = document.getElementById("editName").value;
      const order = document.getElementById("editOrder").value;
      await axios.put(`${baseUrl}/updateCategory`, { id: editId, name, order });
      const editModal = bootstrap.Modal.getInstance(document.getElementById("editModal"));
      editModal.hide();
      loadTableData();
    } catch (error) {
      console.error("修改失败：", error);
    }
  });

  // 保存新增
  document.getElementById("saveAdd").addEventListener("click", async () => {
    try {
      const name = document.getElementById("addName").value;
      const order = document.getElementById("addOrder").value;
      await axios.post(`${baseUrl}/addCategory`, { name, order });
      const addModal = bootstrap.Modal.getInstance(document.getElementById("addModal"));
      addModal.hide();
      loadTableData();
    } catch (error) {
      console.error("新增失败：", error);
    }
  });

  // 分页控制
  prevPageBtn.addEventListener("click", () => {
    if (currentPage > 1) {
      currentPage--;
      loadTableData();
    }
  });
  nextPageBtn.addEventListener("click", () => {
    currentPage++;
    loadTableData();
  });

  // 初始化加载
  loadTableData();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>